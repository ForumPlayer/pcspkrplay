PC Speaker Player - pcspkrplay

Introduction
------------

This program will play PC speaker music in Linux using the Linux input 
devices API.  Currently loosely based on Megazeux style play statements, but
might break on some less compliant play strings.

If you were looking to play PCM sound and music through the PC speaker, this isn't what you want.  Look in to the ALSA driver snd-pcsp for that.  It'll make your PC speaker in to a plain old ALSA "card" for programs to output audio to.


Compiling
---------

Executing:
make

should build it for you.  This doesn't depend on anything special that 
wouldn't come with linux.


Usage
-----

<executable> <options>

Options:
--decompile / -d
	After compiling, decompile back to music string.  

--device    / -e device
	Select event device, default is
	/dev/input/by-path/platform-pcspkr-event-spkr.

--filename  / -f filename
	Read from filename instead of standard input.

--quiet     / -q
	Don't play, only compile (and optionally decompile) then quit.

--display   / -s
	Display playback status.

--help      / -h
	Print quick help/usage.

You will need full read/write access to the event device you wish to use.
Look up the chmod command for information on setting that up.


Music String Format
-------------------

Mostly based on Megazeux's play statement format, but extended for more 
features.

C, D, E, F, G, A, B
	Play a note.

0, 1, 2, 3, 4, 5, 6
	Select octave, default is 3.

#, $
	Placed after a note, moves the note up or down a semitone.  B# is
	accepted and becomes C on the next octave except for 6B#, E becomes F, C$
	becomes B on the previous octave except for 0C$.

Z, T, S, I, Q, H, W
	Select note duration, 64th, 32nd, 16th, 8th, quarter, half, whole.
	Default is 32nd.

+, -
	Increase or decrease octave by 1, clips at 0 and 6.                  

.
	Change duration of folloing notes by 150%.  Can be unset with another
	'.', can override '!'.

!
	Change duration of following notes by 1/3.  Can be unset with another
	'!', can override '.'.

&string&
	Ignores string.  Normally used to play a sample in Megazeux, but for this
	program, you can use it for comments.

*
	Extended command
	b###
		Change BPM from 0 to 999.  (*b060 for 60 BPM)

	d###
		Change to custom note division.  (*d010 for tenth notes)

|
	Doesn't do anything and isn't detected by the engine in any way, but
	this will always be reserved to be used as a bar/separator.

Unknown or malformed commands are ignored.


Examples
--------

echo "cdefgab+c" | ./pcspkrplay
	Play C major scale at octave 3 with 32nd notes.

echo "q2cdefgab+c" | ./pcspkrplay
	Play C major scale at octave 2 with quarter notes.

./pcspkrplay -f song.txt
	Play song.txt.

./pcspkrplay -f song.txt -q --decompile >song_optimized.txt
	Compile then decompile song, size-optimizing it, but don't play it.


Troubleshooting
---------------

open: No such file or directory
	Make sure the file exists, and if it's a different name, provide it to
pcspkrplay using the -e argument.  You might also need to load the PC
speaker driver, pcspkr with:
modprobe pcspkr

open: Operation not permitted
	Make sure you have adequate permission to read and write to the pc
speaker event device.  If you don't you can use something like this as root:
chmod a+rw /dev/input/by-path/platform-pcspkr-event-spkr
NOTE: Running pcspkrplay as root will work but you shouldn't run anything as
root unless you absolutely cannot avoid it.

ioctl: Inappropriate ioctl for device
	The device attempted to use isn't a Linux input device.

Device X does not support sound.
	The input device attempted to use doesn't expose a beeper speaker
interface.


Credits
-------
Design and Program - Paul "paulguy"
Makefile and some help teaching me GIT - Mike Swanson "Chungy"
Example Song - Original: DJ Shadow, PC Speaker cover: "neffy"
